<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>hft,</title>
  <link href="http://scarcecapital.com/hft/tags/research/index.xml" rel="self" />
  <link href="http://scarcecapital.com/hft/tags/research"/>
  <updated>2013-04-23T19:03:35Z</updated>
  <id>http://scarcecapital.com/hft/tags/research/index.xml</id>
  <entry>
        <title type="html">Latency Research</title>
        <author><name>Tony Day</name></author>
        <link href="http://scarcecapital.com/hft/blog/latency-research.html"/>
        <updated>2013-04-12T16:46:00Z</updated>
        <published>2013-04-12T16:46:00Z</published>
        <id>http://scarcecapital.com/hft/blog/latency-research.html</id>
        <category scheme="http://scarcecapital.com/hft/tags/research.html" term="research" label="research"/>
        <content type="html">&lt;p&gt;
I collected trade and order ticks for 12 contracts on 14th March from iqfeed,
and timestamped each tick with current system time. There was about 8 million
data points.
&lt;/p&gt;


&lt;div id="outline-container-sec-1" class="outline-2"&gt;
&lt;h2 id="sec-1"&gt;feed ping latency&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-1"&gt;
&lt;p&gt;
Iqfeed sends a ping once a second as part of the stream.
&lt;/p&gt;

&lt;div class="org-src-container"&gt;

&lt;pre class="src src-R"&gt;t &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;read.csv&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"data/streamt.txt"&lt;/span&gt;,header&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #8cd0d3; background-color: #3f3f3f;"&gt;FALSE&lt;/span&gt;,as.is&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #8cd0d3; background-color: #3f3f3f;"&gt;TRUE&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
pingtime &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;strptime&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;t&lt;span style="color: #bf89d1;"&gt;[&lt;/span&gt;,&lt;span style="color: #7fa08f;"&gt;3&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;]&lt;/span&gt;, &lt;span style="color: #cc9393;"&gt;"%Y%m%d %H:%M:%S"&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
stamp &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;strptime&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;paste&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;strftime&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;pingtime,&lt;span style="color: #cc9393;"&gt;"%Y%m%d"&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;, t&lt;span style="color: #bf89d1;"&gt;[&lt;/span&gt;,&lt;span style="color: #7fa08f;"&gt;1&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;]&lt;/span&gt;, sep&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;" "&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;, &lt;span style="color: #cc9393;"&gt;"%Y%m%d %H:%M:%OS"&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
latency &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;as.double&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;stamp &lt;span style="color: #b9a16c;"&gt;-&lt;/span&gt; pingtime&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
df &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;data.frame&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;pingtime&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;pingtime, latency&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;latency&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
&lt;span style="color: #7a92d4;"&gt;summary&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;df&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"&gt;


&lt;colgroup&gt;
&lt;col class="left"/&gt;

&lt;col class="left"/&gt;
&lt;/colgroup&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td class="left"&gt;Min.   :2013-03-14 07:30:57&lt;/td&gt;
&lt;td class="left"&gt;Min.   :-0.90665&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td class="left"&gt;1st Qu.:2013-03-14 17:15:41&lt;/td&gt;
&lt;td class="left"&gt;1st Qu.:-0.01492&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td class="left"&gt;Median :2013-03-15 03:02:15&lt;/td&gt;
&lt;td class="left"&gt;Median : 0.14950&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td class="left"&gt;Mean   :2013-03-15 03:01:28&lt;/td&gt;
&lt;td class="left"&gt;Mean   : 0.38876&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td class="left"&gt;3rd Qu.:2013-03-15 12:46:33&lt;/td&gt;
&lt;td class="left"&gt;3rd Qu.: 0.22824&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td class="left"&gt;Max.   :2013-03-15 22:33:24&lt;/td&gt;
&lt;td class="left"&gt;Max.   : 7.89887&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td class="left"&gt;NA's   :1&lt;/td&gt;
&lt;td class="left"&gt;NA's   :1&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;div class="org-src-container"&gt;

&lt;pre class="src src-R"&gt;&lt;span style="color: #b9a16c;"&gt;require&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;ggplot2&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
&lt;span style="color: #7a92d4;"&gt;qplot&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;data&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;df, x&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;pingtime, y&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;latency&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
&lt;span style="color: #7a92d4;"&gt;ggsave&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"ping-latency.svg"&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;


&lt;div class="figure"&gt;
&lt;p&gt;&lt;img src="../blog/latency-research/ping-latency.png"  alt="ping-latency.png"/&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
The simple scatterplot shows many negative values, especially when the
market is open, and a step jump in the later pings (when no quotes were
being recorded).  These jumps may be due to changes in my system clock
(automatic appletime resolutions) or due to a lack of accuracy in the
iqfeed pings.
&lt;/p&gt;

&lt;p&gt;
Scatterplots tend to provide dubious visualisation for bigdata, and a new
package out that helps is &lt;a href="http://vita.had.co.nz/papers/bigvis.html"&gt;bigvis&lt;/a&gt;.
&lt;/p&gt;

&lt;p&gt;
Bigvis is not yet available at CRAN but can be installed via a github
repository (see &lt;a href="https://github.com/hadley/bigvis"&gt;https://github.com/hadley/bigvis&lt;/a&gt; for details).
&lt;/p&gt;

&lt;div class="org-src-container"&gt;

&lt;pre class="src src-R"&gt;&lt;span style="color: #7a92d4;"&gt;install.packages&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"devtools"&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
devtools::&lt;span style="color: #7a92d4;"&gt;install_github&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"bigvis"&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;
Bigvis doesn't handle non-numeric data (like time), so rather than
autopilot, I use ggplot directly.
&lt;/p&gt;

&lt;div class="org-src-container"&gt;

&lt;pre class="src src-R"&gt;&lt;span style="color: #b9a16c;"&gt;require&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;bigvis&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
&lt;span style="color: #b9a16c;"&gt;require&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;ggplot2&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
dfn &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;condense&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;bin&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;as.double&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;df$pingtime&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;,&lt;span style="color: #7fa08f;"&gt;60&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;,&lt;span style="color: #7a92d4;"&gt;bin&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;df$latency,&lt;span style="color: #7fa08f;"&gt;.1&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;))&lt;/span&gt;
dfg &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;data.frame&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;as.POSIXct&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;dfn&lt;span style="color: #bf89d1;"&gt;[&lt;/span&gt;,&lt;span style="color: #7fa08f;"&gt;1&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;]&lt;/span&gt;,origin&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"1960-01-01"&lt;/span&gt;, tz&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"GMT"&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;,dfn&lt;span style="color: #bf89d1;"&gt;[&lt;/span&gt;,&lt;span style="color: #7fa08f;"&gt;2&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;]&lt;/span&gt;,dfn&lt;span style="color: #bf89d1;"&gt;[&lt;/span&gt;,&lt;span style="color: #7fa08f;"&gt;3&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;])&lt;/span&gt;
&lt;span style="color: #7a92d4;"&gt;colnames&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;dfg&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt; &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;c&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"Time"&lt;/span&gt;,&lt;span style="color: #cc9393;"&gt;"Latency"&lt;/span&gt;,&lt;span style="color: #cc9393;"&gt;"Count"&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
g &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;ggplot&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;data&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;dfg,&lt;span style="color: #7a92d4;"&gt;aes&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;x&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;Time,y&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;Latency&lt;span style="color: #bf89d1;"&gt;))&lt;/span&gt;
g &lt;span style="color: #b9a16c;"&gt;+&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;geom_tile&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;aes&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;fill&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;Count&lt;span style="color: #bf89d1;"&gt;))&lt;/span&gt; &lt;span style="color: #b9a16c;"&gt;+&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;scale_fill_gradient&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;low&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"#e5e5e5"&lt;/span&gt;, high &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #cc9393;"&gt;"#444548"&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt; &lt;span style="color: #b9a16c;"&gt;+&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;scale_y_continuous&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;limits&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;c&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #b9a16c;"&gt;-&lt;/span&gt;&lt;span style="color: #7fa08f;"&gt;1&lt;/span&gt;,&lt;span style="color: #7fa08f;"&gt;1&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;))&lt;/span&gt;
&lt;span style="color: #7a92d4;"&gt;ggsave&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"ping-latency-condensed.svg"&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;


&lt;div class="figure"&gt;
&lt;p&gt;&lt;img src="../blog/latency-research/ping-latency-condensed.svg"  alt="ping-latency-condensed.svg"/&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
Using the bigvis techniques clarifies a few main issues for further research:
&lt;/p&gt;
&lt;ul class="org-ul"&gt;
&lt;li&gt;there is a step jump near market open where the majority of the pings
jump from around 250 msecs to -750 msecs. This looks like either a coding
error or the ping being off by up to a second.
&lt;/li&gt;
&lt;li&gt;during market open (when tick volume is high) ping can vary by a second.
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;


&lt;div id="outline-container-sec-2" class="outline-2"&gt;
&lt;h2 id="sec-2"&gt;disconnects&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-2"&gt;
&lt;p&gt;
Just looking at the ping counts after binning into one minute intervals:
&lt;/p&gt;

&lt;div class="org-src-container"&gt;

&lt;pre class="src src-R"&gt;df.dis &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;condense&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;bin&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;as.double&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;df$pingtime&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;,&lt;span style="color: #7fa08f;"&gt;60&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;))&lt;/span&gt;
dfg &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;data.frame&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;as.POSIXct&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;df.dis&lt;span style="color: #bf89d1;"&gt;[&lt;/span&gt;,&lt;span style="color: #7fa08f;"&gt;1&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;]&lt;/span&gt;,origin&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"1960-01-01"&lt;/span&gt;, tz&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"GMT"&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;,&lt;span style="color: #7fa08f;"&gt;60&lt;/span&gt;&lt;span style="color: #b9a16c;"&gt;-&lt;/span&gt;df.dis&lt;span style="color: #bf89d1;"&gt;[&lt;/span&gt;,&lt;span style="color: #7fa08f;"&gt;2&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;])&lt;/span&gt;
&lt;span style="color: #7a92d4;"&gt;colnames&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;dfg&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt; &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;c&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"Time"&lt;/span&gt;,&lt;span style="color: #cc9393;"&gt;"Count"&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
g &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;ggplot&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;data&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;dfg,&lt;span style="color: #7a92d4;"&gt;aes&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;x&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;Time,y&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;Count&lt;span style="color: #bf89d1;"&gt;))&lt;/span&gt;
g &lt;span style="color: #b9a16c;"&gt;+&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;geom_line&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;aes&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;())&lt;/span&gt;
&lt;span style="color: #7a92d4;"&gt;ggsave&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"disconnects.png"&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;


&lt;div class="figure"&gt;
&lt;p&gt;&lt;img src="../blog/latency-research/disconnects.png"  alt="disconnects.png"/&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
iqfeed regularly suffers from disconnects with reconnection occuring within
a minute.
&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;div id="outline-container-sec-3" class="outline-2"&gt;
&lt;h2 id="sec-3"&gt;event latency&lt;/h2&gt;
&lt;div class="outline-text-2" id="text-3"&gt;
&lt;p&gt;
The ticks for the day were processed into column-data formats using the mmap
package from R (see hft.org for the gory details).
&lt;/p&gt;

&lt;p&gt;
From the R database of the one day quote ticks&amp;#x2026;
&lt;/p&gt;

&lt;ul class="org-ul"&gt;
&lt;li&gt;open data
&lt;div class="org-src-container"&gt;

&lt;pre class="src src-R"&gt;&lt;span style="color: #7a92d4;"&gt;rm&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;list &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;ls&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;())&lt;/span&gt;
&lt;span style="color: #b9a16c;"&gt;require&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"mmap"&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
&lt;span style="color: #b9a16c;"&gt;require&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"rindex"&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
&lt;span style="color: #b9a16c;"&gt;require&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"plyr"&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
&lt;span style="color: #b9a16c;"&gt;require&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"stringr"&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
raw.stream &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #cc9393;"&gt;"streamqh"&lt;/span&gt;
&lt;span style="color: #7f9f7f;"&gt;# &lt;/span&gt;&lt;span style="color: #7f9f7f;"&gt;where the mmap db is located&lt;/span&gt;
db.path &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;paste&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"data/"&lt;/span&gt;,raw.stream,&lt;span style="color: #cc9393;"&gt;"/"&lt;/span&gt;,sep&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;""&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;

&lt;span style="color: #7a92d4;"&gt;load&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;paste&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;db.path,&lt;span style="color: #cc9393;"&gt;".Rdbinfo"&lt;/span&gt;,sep&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;""&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;))&lt;/span&gt;
&lt;span style="color: #7f9f7f;"&gt;#&lt;/span&gt;&lt;span style="color: #7f9f7f;"&gt;m = mmap(main.filename, mode=st)&lt;/span&gt;
stream &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #8cd0d3; background-color: #3f3f3f;"&gt;NULL&lt;/span&gt;
stream$stamp &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;mmap&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;paste&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;db.path,fields&lt;span style="color: #bf89d1;"&gt;[&lt;/span&gt;&lt;span style="color: #7fa08f;"&gt;1&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;]&lt;/span&gt;,&lt;span style="color: #cc9393;"&gt;".data"&lt;/span&gt;,sep&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;""&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;, mode&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;double&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;())&lt;/span&gt;
stream$code &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;mmap&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;paste&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;db.path,fields&lt;span style="color: #bf89d1;"&gt;[&lt;/span&gt;&lt;span style="color: #7fa08f;"&gt;2&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;]&lt;/span&gt;,&lt;span style="color: #cc9393;"&gt;".data"&lt;/span&gt;,sep&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;""&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;, mode&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;char&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7fa08f;"&gt;1&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;))&lt;/span&gt;
stream$symbol &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;mmap&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;paste&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;db.path,fields&lt;span style="color: #bf89d1;"&gt;[&lt;/span&gt;&lt;span style="color: #7fa08f;"&gt;3&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;]&lt;/span&gt;,&lt;span style="color: #cc9393;"&gt;".data"&lt;/span&gt;,sep&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;""&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;, mode&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;char&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;ticker.length&lt;span style="color: #bf89d1;"&gt;))&lt;/span&gt;
stream$trade &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;mmap&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;paste&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;db.path,fields&lt;span style="color: #bf89d1;"&gt;[&lt;/span&gt;&lt;span style="color: #7fa08f;"&gt;4&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;]&lt;/span&gt;,&lt;span style="color: #cc9393;"&gt;".data"&lt;/span&gt;,sep&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;""&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;, mode&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;double&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;())&lt;/span&gt;
stream$vol &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;mmap&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;paste&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;db.path,fields&lt;span style="color: #bf89d1;"&gt;[&lt;/span&gt;&lt;span style="color: #7fa08f;"&gt;5&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;]&lt;/span&gt;,&lt;span style="color: #cc9393;"&gt;".data"&lt;/span&gt;,sep&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;""&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;, mode&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;integer&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;())&lt;/span&gt;
stream$tradetime &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;mmap&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;paste&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;db.path,fields&lt;span style="color: #bf89d1;"&gt;[&lt;/span&gt;&lt;span style="color: #7fa08f;"&gt;6&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;]&lt;/span&gt;,&lt;span style="color: #cc9393;"&gt;".data"&lt;/span&gt;,sep&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;""&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;, mode&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;double&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;())&lt;/span&gt;
stream$tradeex &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;mmap&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;paste&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;db.path,fields&lt;span style="color: #bf89d1;"&gt;[&lt;/span&gt;&lt;span style="color: #7fa08f;"&gt;7&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;]&lt;/span&gt;,&lt;span style="color: #cc9393;"&gt;".data"&lt;/span&gt;,sep&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;""&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;, mode&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;double&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;())&lt;/span&gt;
stream$volex &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;mmap&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;paste&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;db.path,fields&lt;span style="color: #bf89d1;"&gt;[&lt;/span&gt;&lt;span style="color: #7fa08f;"&gt;8&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;]&lt;/span&gt;,&lt;span style="color: #cc9393;"&gt;".data"&lt;/span&gt;,sep&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;""&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;, mode&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;integer&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;())&lt;/span&gt;
stream$tradetimeex &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;mmap&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;paste&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;db.path,fields&lt;span style="color: #bf89d1;"&gt;[&lt;/span&gt;&lt;span style="color: #7fa08f;"&gt;9&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;]&lt;/span&gt;,&lt;span style="color: #cc9393;"&gt;".data"&lt;/span&gt;,sep&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;""&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;, mode&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;double&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;())&lt;/span&gt;
stream$voltot &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;mmap&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;paste&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;db.path,fields&lt;span style="color: #bf89d1;"&gt;[&lt;/span&gt;&lt;span style="color: #7fa08f;"&gt;10&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;]&lt;/span&gt;,&lt;span style="color: #cc9393;"&gt;".data"&lt;/span&gt;,sep&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;""&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;, mode&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;integer&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;())&lt;/span&gt;
stream$bid &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;mmap&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;paste&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;db.path,fields&lt;span style="color: #bf89d1;"&gt;[&lt;/span&gt;&lt;span style="color: #7fa08f;"&gt;11&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;]&lt;/span&gt;,&lt;span style="color: #cc9393;"&gt;".data"&lt;/span&gt;,sep&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;""&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;, mode&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;double&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;())&lt;/span&gt;
stream$bidvol &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;mmap&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;paste&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;db.path,fields&lt;span style="color: #bf89d1;"&gt;[&lt;/span&gt;&lt;span style="color: #7fa08f;"&gt;12&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;]&lt;/span&gt;,&lt;span style="color: #cc9393;"&gt;".data"&lt;/span&gt;,sep&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;""&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;, mode&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;integer&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;())&lt;/span&gt;
stream$bidtime &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;mmap&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;paste&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;db.path,fields&lt;span style="color: #bf89d1;"&gt;[&lt;/span&gt;&lt;span style="color: #7fa08f;"&gt;13&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;]&lt;/span&gt;,&lt;span style="color: #cc9393;"&gt;".data"&lt;/span&gt;,sep&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;""&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;, mode&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;double&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;())&lt;/span&gt;
stream$ask &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;mmap&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;paste&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;db.path,fields&lt;span style="color: #bf89d1;"&gt;[&lt;/span&gt;&lt;span style="color: #7fa08f;"&gt;14&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;]&lt;/span&gt;,&lt;span style="color: #cc9393;"&gt;".data"&lt;/span&gt;,sep&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;""&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;, mode&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;double&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;())&lt;/span&gt;
stream$askvol &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;mmap&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;paste&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;db.path,fields&lt;span style="color: #bf89d1;"&gt;[&lt;/span&gt;&lt;span style="color: #7fa08f;"&gt;15&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;]&lt;/span&gt;,&lt;span style="color: #cc9393;"&gt;".data"&lt;/span&gt;,sep&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;""&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;, mode&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;integer&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;())&lt;/span&gt;
stream$asktime &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;mmap&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;paste&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;db.path,fields&lt;span style="color: #bf89d1;"&gt;[&lt;/span&gt;&lt;span style="color: #7fa08f;"&gt;16&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;]&lt;/span&gt;,&lt;span style="color: #cc9393;"&gt;".data"&lt;/span&gt;,sep&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;""&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;, mode&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;double&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;())&lt;/span&gt;
stream$event &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;mmap&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;paste&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;db.path,fields&lt;span style="color: #bf89d1;"&gt;[&lt;/span&gt;&lt;span style="color: #7fa08f;"&gt;17&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;]&lt;/span&gt;,&lt;span style="color: #cc9393;"&gt;".data"&lt;/span&gt;,sep&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;""&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;, mode&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;char&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7fa08f;"&gt;12&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;))&lt;/span&gt;
stream$id &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;mmap&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;paste&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;db.path,fields&lt;span style="color: #bf89d1;"&gt;[&lt;/span&gt;&lt;span style="color: #7fa08f;"&gt;18&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;]&lt;/span&gt;,&lt;span style="color: #cc9393;"&gt;".data"&lt;/span&gt;,sep&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;""&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;, mode&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;integer&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;())&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;

&lt;li&gt;Define events and extract relevant times
&lt;div class="org-src-container"&gt;

&lt;pre class="src src-R"&gt;n &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;length&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;stream$event&lt;span style="color: #bf89d1;"&gt;[])&lt;/span&gt;

tC &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;grepl&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"C"&lt;/span&gt;,stream$event&lt;span style="color: #bf89d1;"&gt;[])&lt;/span&gt;
tO &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;grepl&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"O"&lt;/span&gt;,stream$event&lt;span style="color: #bf89d1;"&gt;[])&lt;/span&gt;
ta &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;grepl&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"a"&lt;/span&gt;,stream$event&lt;span style="color: #bf89d1;"&gt;[])&lt;/span&gt;
tb &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;grepl&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"b"&lt;/span&gt;,stream$event&lt;span style="color: #bf89d1;"&gt;[])&lt;/span&gt;
ta &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; ta &amp;amp; !&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;tC | tO&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
tb &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; tb &amp;amp; !&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;tC | tO | ta&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
tother &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; !&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;ta | tb | tC | tO&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;

event.category &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7fa08f;"&gt;1&lt;/span&gt; * tC&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt; &lt;span style="color: #b9a16c;"&gt;+&lt;/span&gt; &lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7fa08f;"&gt;2&lt;/span&gt; * tO&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt; &lt;span style="color: #b9a16c;"&gt;+&lt;/span&gt; &lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7fa08f;"&gt;3&lt;/span&gt; * ta&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt; &lt;span style="color: #b9a16c;"&gt;+&lt;/span&gt; &lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7fa08f;"&gt;4&lt;/span&gt; * tb&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt; &lt;span style="color: #b9a16c;"&gt;+&lt;/span&gt; &lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7fa08f;"&gt;5&lt;/span&gt; * tother&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;

event.time &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;stream$tradetime&lt;span style="color: #bf89d1;"&gt;[]&lt;/span&gt; * tC &lt;span style="color: #b9a16c;"&gt;+&lt;/span&gt;
        stream$tradetimeex&lt;span style="color: #bf89d1;"&gt;[]&lt;/span&gt; * tO &lt;span style="color: #b9a16c;"&gt;+&lt;/span&gt;
        stream$asktime&lt;span style="color: #bf89d1;"&gt;[]&lt;/span&gt; * ta &lt;span style="color: #b9a16c;"&gt;+&lt;/span&gt;
        stream$bidtime&lt;span style="color: #bf89d1;"&gt;[]&lt;/span&gt; * tb &lt;span style="color: #b9a16c;"&gt;+&lt;/span&gt;
        stream$tradetime&lt;span style="color: #bf89d1;"&gt;[]&lt;/span&gt; * tother&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;

event.time.posix &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;as.POSIXct&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;event.time,origin&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"1960-01-01"&lt;/span&gt;, tz&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"GMT"&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
event.stamp &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; stream$stamp&lt;span style="color: #bf89d1;"&gt;[]&lt;/span&gt;

event.latency &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; event.stamp &lt;span style="color: #b9a16c;"&gt;-&lt;/span&gt; event.time

event.df &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;data.frame&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;symbol&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;stream$symbol&lt;span style="color: #bf89d1;"&gt;[]&lt;/span&gt;,event.category,event.time, event.stamp, event.latency&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
&lt;span style="color: #7a92d4;"&gt;summary&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;event.df&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;

&lt;table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"&gt;


&lt;colgroup&gt;
&lt;col class="left"/&gt;

&lt;col class="left"/&gt;

&lt;col class="left"/&gt;

&lt;col class="left"/&gt;

&lt;col class="left"/&gt;
&lt;/colgroup&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td class="left"&gt;@ESM13 :2553308&lt;/td&gt;
&lt;td class="left"&gt;Min.   :1.000&lt;/td&gt;
&lt;td class="left"&gt;Min.   :1.366e+09&lt;/td&gt;
&lt;td class="left"&gt;Min.   :1.366e+09&lt;/td&gt;
&lt;td class="left"&gt;Min.   :-85800.76&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td class="left"&gt;@NQM13 :1285545&lt;/td&gt;
&lt;td class="left"&gt;1st Qu.:3.000&lt;/td&gt;
&lt;td class="left"&gt;1st Qu.:1.366e+09&lt;/td&gt;
&lt;td class="left"&gt;1st Qu.:1.366e+09&lt;/td&gt;
&lt;td class="left"&gt;1st Qu.:     0.22&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td class="left"&gt;@YMM13 :1216006&lt;/td&gt;
&lt;td class="left"&gt;Median :3.000&lt;/td&gt;
&lt;td class="left"&gt;Median :1.366e+09&lt;/td&gt;
&lt;td class="left"&gt;Median :1.366e+09&lt;/td&gt;
&lt;td class="left"&gt;Median :     0.33&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td class="left"&gt;EBK13  : 917275&lt;/td&gt;
&lt;td class="left"&gt;Mean   :3.107&lt;/td&gt;
&lt;td class="left"&gt;Mean   :1.366e+09&lt;/td&gt;
&lt;td class="left"&gt;Mean   :1.366e+09&lt;/td&gt;
&lt;td class="left"&gt;Mean   :   226.44&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td class="left"&gt;@JYM13 : 844995&lt;/td&gt;
&lt;td class="left"&gt;3rd Qu.:4.000&lt;/td&gt;
&lt;td class="left"&gt;3rd Qu.:1.366e+09&lt;/td&gt;
&lt;td class="left"&gt;3rd Qu.:1.366e+09&lt;/td&gt;
&lt;td class="left"&gt;3rd Qu.:   600.22&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td class="left"&gt;EBM13  : 610827&lt;/td&gt;
&lt;td class="left"&gt;Max.   :5.000&lt;/td&gt;
&lt;td class="left"&gt;Max.   :1.366e+09&lt;/td&gt;
&lt;td class="left"&gt;Max.   :1.366e+09&lt;/td&gt;
&lt;td class="left"&gt;Max.   :  9818.25&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td class="left"&gt;(Other):1373320&lt;/td&gt;
&lt;td class="left"&gt;nil&lt;/td&gt;
&lt;td class="left"&gt;nil&lt;/td&gt;
&lt;td class="left"&gt;nil&lt;/td&gt;
&lt;td class="left"&gt;nil&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/li&gt;

&lt;li&gt;bigvis manipulations
&lt;div class="org-src-container"&gt;

&lt;pre class="src src-R"&gt;&lt;span style="color: #b9a16c;"&gt;require&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"bigvis"&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
&lt;span style="color: #b9a16c;"&gt;require&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"ggplot2"&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
df1 &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;condense&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;bin&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;event.df$event.time,&lt;span style="color: #7fa08f;"&gt;60&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;,&lt;span style="color: #7a92d4;"&gt;bin&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;event.df$event.latency,&lt;span style="color: #7fa08f;"&gt;0.05&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;))&lt;/span&gt;
df2 &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; df1&lt;span style="color: #bf89d1;"&gt;[(&lt;/span&gt;df1$event.df.event.latency &lt;span style="color: #b9a16c;"&gt;&amp;gt;&lt;/span&gt; &lt;span style="color: #7fa08f;"&gt;0&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt; &amp;amp; &lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;df1$event.df.event.latency &lt;span style="color: #b9a16c;"&gt;&amp;lt;&lt;/span&gt; &lt;span style="color: #7fa08f;"&gt;1&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;,&lt;span style="color: #bf89d1;"&gt;]&lt;/span&gt;
dfg &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;data.frame&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;as.POSIXct&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;df2&lt;span style="color: #bf89d1;"&gt;[&lt;/span&gt;,&lt;span style="color: #7fa08f;"&gt;1&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;]&lt;/span&gt;&lt;span style="color: #b9a16c;"&gt;+&lt;/span&gt;&lt;span style="color: #7fa08f;"&gt;10&lt;/span&gt;*&lt;span style="color: #7fa08f;"&gt;60&lt;/span&gt;*&lt;span style="color: #7fa08f;"&gt;60&lt;/span&gt;,origin&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"1960-01-01"&lt;/span&gt;, tz&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;""&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;,df2&lt;span style="color: #bf89d1;"&gt;[&lt;/span&gt;,&lt;span style="color: #7fa08f;"&gt;2&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;]&lt;/span&gt;,df2&lt;span style="color: #bf89d1;"&gt;[&lt;/span&gt;,&lt;span style="color: #7fa08f;"&gt;3&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;])&lt;/span&gt;
&lt;span style="color: #7a92d4;"&gt;colnames&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;dfg&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt; &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;c&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"Time"&lt;/span&gt;,&lt;span style="color: #cc9393;"&gt;"Latency"&lt;/span&gt;,&lt;span style="color: #cc9393;"&gt;"Count"&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
g &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;ggplot&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;data&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;dfg,&lt;span style="color: #7a92d4;"&gt;aes&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;x&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;Time,y&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;Latency&lt;span style="color: #bf89d1;"&gt;))&lt;/span&gt;
g &lt;span style="color: #b9a16c;"&gt;+&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;geom_tile&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;aes&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;fill&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;Count&lt;span style="color: #bf89d1;"&gt;))&lt;/span&gt; &lt;span style="color: #b9a16c;"&gt;+&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;scale_fill_gradient&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;low&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"#e5e5e5"&lt;/span&gt;, high &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #cc9393;"&gt;"#444548"&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt; &lt;span style="color: #b9a16c;"&gt;+&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;scale_y_continuous&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;limits&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;c&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #b9a16c;"&gt;-&lt;/span&gt;&lt;span style="color: #7fa08f;"&gt;1&lt;/span&gt;,&lt;span style="color: #7fa08f;"&gt;1&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;))&lt;/span&gt;
&lt;span style="color: #7a92d4;"&gt;ggsave&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"quote-latency-condensed.svg"&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;


&lt;div class="figure"&gt;
&lt;p&gt;&lt;img src="../blog/latency-research/quote-latency-condensed.svg"  alt="quote-latency-condensed.svg"/&gt;&lt;/p&gt;
&lt;/div&gt;

&lt;p&gt;
Unlike the iqfeed ping, there is a consistent latency pattern when comparing
market stamp and local system stamp, with no spurious negative values.
Latency values from 9am to 4pm (regular market open) at 500 millsecs are
common and may be due to TCP issues (dropped packets say).
&lt;/p&gt;
&lt;/li&gt;

&lt;li&gt;symbols

&lt;div class="org-src-container"&gt;

&lt;pre class="src src-R"&gt;&lt;span style="color: #7a92d4;"&gt;summary&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;as.factor&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;stream$symbol&lt;span style="color: #bf89d1;"&gt;[]))&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;/li&gt;

&lt;li&gt;emini latency

&lt;p&gt;
The latency pattern for the E-MINI SP500 (@ESM13 is the iqfeed code) is
very similar to the overall latency pattern. The average latency over the
day was:
&lt;/p&gt;

&lt;div class="org-src-container"&gt;

&lt;pre class="src src-R"&gt;&lt;span style="color: #b9a16c;"&gt;require&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;ggplot2&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
&lt;span style="color: #b9a16c;"&gt;require&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;bigvis&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
ind.emini &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;indexEQ&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;ind.symbol,&lt;span style="color: #cc9393;"&gt;"@ESM13 "&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
df1 &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;condense&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;bin&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;event.df$event.time&lt;span style="color: #bf89d1;"&gt;[&lt;/span&gt;ind.emini&lt;span style="color: #bf89d1;"&gt;]&lt;/span&gt;,&lt;span style="color: #7fa08f;"&gt;300&lt;/span&gt;,name&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"time"&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;,&lt;span style="color: #7a92d4;"&gt;bin&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;event.df$event.latency&lt;span style="color: #bf89d1;"&gt;[&lt;/span&gt;ind.emini&lt;span style="color: #bf89d1;"&gt;]&lt;/span&gt;,&lt;span style="color: #7fa08f;"&gt;0.05&lt;/span&gt;,name&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"latency"&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;))&lt;/span&gt;
df2 &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; df1&lt;span style="color: #bf89d1;"&gt;[(&lt;/span&gt;df1$latency &lt;span style="color: #b9a16c;"&gt;&amp;gt;&lt;/span&gt; &lt;span style="color: #7fa08f;"&gt;0&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt; &amp;amp; &lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;df1$latency &lt;span style="color: #b9a16c;"&gt;&amp;lt;&lt;/span&gt; &lt;span style="color: #7fa08f;"&gt;2&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;,&lt;span style="color: #bf89d1;"&gt;]&lt;/span&gt;
lat.av &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;tapply&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;df2$latency*df2$.count,df2$time,sum&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;&lt;span style="color: #b9a16c;"&gt;/&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;tapply&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;df2$.count,df2$time,sum&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
dfg &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;data.frame&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;Time&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;as.POSIXct&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;as.double&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #7a92d4;"&gt;row.names&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;lat.av&lt;span style="color: #bf89d1;"&gt;))&lt;/span&gt;&lt;span style="color: #b9a16c;"&gt;+&lt;/span&gt;&lt;span style="color: #7fa08f;"&gt;10&lt;/span&gt;*&lt;span style="color: #7fa08f;"&gt;60&lt;/span&gt;*&lt;span style="color: #7fa08f;"&gt;60&lt;/span&gt;,origin&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"1960-01-01"&lt;/span&gt;, tz&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;""&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;,Latency&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;lat.av&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
&lt;span style="color: #7f9f7f;"&gt;#&lt;/span&gt;&lt;span style="color: #7f9f7f;"&gt;colnames(dfg) = c("Time","Latency","Count")&lt;/span&gt;
g &lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;ggplot&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;data&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;dfg,&lt;span style="color: #7a92d4;"&gt;aes&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;x&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;Time,y&lt;span style="color: #b9a16c;"&gt;=&lt;/span&gt;Latency&lt;span style="color: #bf89d1;"&gt;))&lt;/span&gt;
g &lt;span style="color: #b9a16c;"&gt;+&lt;/span&gt; &lt;span style="color: #7a92d4;"&gt;geom_point&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;()&lt;/span&gt;
&lt;span style="color: #7a92d4;"&gt;ggsave&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;(&lt;/span&gt;&lt;span style="color: #cc9393;"&gt;"quote-latency-averagecondensed.svg"&lt;/span&gt;&lt;span style="color: #bf89d1;"&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;


&lt;div class="figure"&gt;
&lt;p&gt;&lt;img src="../blog/latency-research/quote-latency-averagecondensed.svg"  alt="quote-latency-averagecondensed.svg"/&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
</content>
        </entry>
        
</feed>
